---
- hosts: all
  become: yes
  vars:
    a:
      - java
      - git
      - maven
  tasks:
    - name: install packages
      yum:
        name: "{{a}}"
        state: present

    - name: Download Apache Tomcat
      get_url:
        url: "https://dlcdn.apache.org/tomcat/tomcat-9/v9.0.89/bin/apache-tomcat-9.0.89.tar.gz"
        dest: /tmp/
    - name: Extract Tomcat
      unarchive:
        src: /tmp/apache-tomcat-9.0.89.tar.gz
        dest: /opt
        remote_src: yes

    - name: run  Tomcat
      shell: nohup ./startup.sh
      args:
        chdir: /opt/apache-tomcat-9.0.89/bin

- hosts: all
  become: true
  tasks:
    - name: Clone Git repository
      git:
       repo: https://github.com/praveen-gogula/casino.git
       dest: "casino"

    - name: Build project with Maven
      command: mvn package
      args:
        chdir: "casino"

    - name: deploy war file into tomcat
      copy:
       src: casino/target/casino.war
       dest: /opt/apache-tomcat-9.0.89/webapps/ROOT.war
       remote_src: yes